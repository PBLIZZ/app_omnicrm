# 🧠 Feature Scratchpad — Notes Feature

## Clarifying Questions

### 1. Quick Capture UI Pattern

You mentioned a card/sheet that opens with type or record options (like AI chat interfaces):

  A. Should this be a modal dialog (center
   screen, overlay) or a sheet (slides
  from bottom/side)?
User is in the app, whereever and wants to add a quick note for the contact she just spoke to or the session earlier, she clicks on the lightningbolt note icon and her work that she was doing in the background is not affected, now she opens the quick capture interface and it takes over the whole screen ie she cant access anything else, and so has focus, she has an input bar for text that she can type into and as she presses enter the text appears in the note, she could also click the mic icon in the input bar and her microphone will record her speech. When she finishes speaking she must click a tick button in the input bar and the rest of what she was saying is also added to the note, if she wants to edit anything she has said or typed she can edit inline in the note.  select the point of the cursor in the note and delete or backspace, copy one part and paste it above or below, type directly in the note or position the cursor where she wants the next text to be and click mic again. When she is happy with the note shwe clciks the save button and the note is saved to the notes table undergoing pii redaction at the server level, her interface closes and she can access the rest of the app again. Once the server has processed and saved the note a toast appears to say note saved and if pii was redacted another toast warning in red, pii information detected and sucessfully redfacted, appears. this is regardless odf hwere she is now in the app.  the background of the place where she is in the app should be dimmed to show that the quick capture interface is open and she cant access anything else.THe quick capture note interface should say that for editing options exist in the note detail page and can be accessed by clciking add note in the contact details card or by going to /contact/[contactId]/notes
  B. For the quick capture interface:

- Plain text only (no formatting
  toolbar)? Correct
- Maximum character limit? (e.g., 5000
  chars) 1200 should be sufficient or how many words can someone say in 3 mins, if she wants to add longer notes she should open the add note button instead of quick capture, we could also rename it rapid note to indicate something short and simple
- Auto-save drafts if user closes
  without saving?
yes
  C. Voice recording workflow:

- Should it transcribe in real-time
  (streaming) or after recording finishes? After is fine
- Max recording duration? (e.g., 5
  minutes, 10 minutes) 3 mins
- Show waveform visualization while
  recording? yes, feedbvack is important so the user knows when the recording is finished

### 2. "Latest Smart Notes" Card (Timeline)

Adapting the "Latest Price Movement"
  card for notes:

  A. Timeline display options - which do
  you prefer?

  1. Option 1: Date on left → Timeline
  circle → Session type (e.g., "Hot Stones
   Massage") → AI-generated summary below
  2. Option 2: Date on left → Timeline
  circle → Note title/first line → Full
  scrollable note on click
  3. Option 3: Date on left → Timeline
  circle → Session type + sentiment
  indicator → Summary as main text

  if it will be a timeline it will have session notes summarised by ai, events attended (sessions), conversations recorded (email), all summarised by ai and then merged chronologically Ai-Insights table will capture events and emails from the interactions tableand notes from the notes table and merge them chronologically

  B. Sentiment indicators:

- Show on every note or only when
  significant changes detected?
- Color scheme: 🔴 Red
  (declining/concerned) | 🔵 Blue
  (neutral/stable) | 🟢 Green
  (improving/positive)?
- Should sentiment be AI-calculated from
   note content or from structured data
  (e.g., goal progress)?

  show on every note that is appropriate, but also as a user if i scroll down and see appointment cancelled red, appointment rescheduled(email) neutral, appointment attended green event), note summary from that sessiojn (green - well depending on the note but generaly i suppose it will be green, no note recorded for session, red) and so on fo r as long as the user has past contact interactions with the contact. Sentiment is recorded in the ai insights table for each interaction or note ie each insight. And is generated by ai at time of processing.  

  C. Timeline construction:

- Should it include: Notes + Sessions +
  Correspondence + Events (all merged
  chronologically)? Sessions are events
- Or should it be notes-only with
  session context shown as metadata? no

### 3. "Recent Developments" Cards (3 Latest

   Notes)

  You mentioned adapting the three cards
  under "Recent Developments" for the 3
  latest full notes:

  A. Card content structure:

  1. Header: Session type + Date +
  Sentiment arrow? no sentiment this is pure user generated content.  Session ie type of appointment or class attended plus date of session or class etc, plus the note added by the user, the note should be for the date of the session to which it refers and not the date the note was added
  2. Body: Full note content (scrollable
  within card)?yes keep the card size fixed more or less square three wide and scrollable within the card if the note is long but dont show the scroll bar
  3. Footer: Tags, linked goals, "View
  full" link? not here unless the user tags her own notes,, (need to make sure user can add any of the 36 tags available to the note within the editor (not availbake in the rapid note input))

  B. Expandable/collapsible behavior:

- Should cards start collapsed (showing
  only first 3-4 lines)?no
- Expand on click to show full
  scrollable content?no
- Or always show full content within
  fixed-height scrollable area? This one, yes

  C. Card ordering:

- Strictly chronological (most recent
  first)?yes
- Or prioritize by importance (e.g.,
  flagged notes, notes with unresolved
  issues)?no

### 4. "Key Issues" Section → "Next Steps &

  Goals"

  Adapting the collapsible "Key Issues"
  section:

  A. Content display - which format?

  1. Option 1: First item (most urgent)
  auto-expanded, rest collapsed
  2. Option 2: All collapsed by default,
  user expands as needed
  3. Option 3: All expanded if 3 or fewer
  items, otherwise collapsed

  there will be only two as its for Goals and Next Steps and the first onbe is expanded and the second one no, and this is ai generated from ai insights table

  B. "Next Steps" data source:

- Extract from latest note using keyword
   detection (e.g., "client will...",
  "homework:", "action item:")?
- Pull from AI insights table
  (next_steps field)?yes
- Or from linked tasks (query tasks
  table where sourceNoteId matches)? hmmm we have a goals tabkle that will record goals for the user (business and personal ) as well as goals for the clients.  the goals should be linked to client (contact) or user. tasks can be assigned to goals goals in the contact details card are a summary of the goals for that contact. the goals entry point should be add goal to contact or userwith ui.  adding a goal requires the contact id or user id, and has the heading content measurables and progress or whatever is in the table, we can expand it if needed,. I dont know how we create tasks for clients we can add tasks for the user and tag a client or clients but that is for the user to take action regarding the client not for the completion of the clients goals,

  C. "Goals" data source:

- Show all active goals for contact
  (from goals table where status !=
  'abandoned')? i dont understand this abandoned requisite, why abandoned or not abandoned. Anyway the display of goals is ai summary with scroll down for previous goals added or updated and comes from the ai insights table i think, god there is a lot of expectation on the asi insights table
- Or only goals mentioned in recent
  notes (via note_goals junction table)?idk
- Display format: Goal name + progress
  indicator (e.g., "Weight Loss Goal - 60%
   complete")? depends on the measurables oiutlinesd when the goal is set, if progress can be objective then have the progress bar

### 5. AI Integration & Insights

  A. AI Insights Card positioning:

- Should it be a separate collapsible
  card below notes?
- Or integrated into the sidebar (like
  your original spec mentioned)?
- Placement preference: Above notes
  section, below notes, or as a
  toggle-able overlay?

  ai insights card is the actual summary upto date based on the last 6 rows of the insights table for that contact and is only expanbded when the user wants to see what the story is possibly before a session. my thought was that it would be a side bar type collapsible like the ticker prices on the right in the perplexity finances display but the trigger for ai insights could pulsate or something to indicate that it is there and can be expanded. it is a second sidebar on the right not the sidebar on the left that is for nav and other stuff

  B. AI reading permissions:

- AI can read: All notes + Interactions yes

- Sessions for insight generation? yes

- AI generates insights on: Background
  job trigger after note save? yes
- AI insight types to display: Risk
  flags, adherence trends, suggested
  agenda, sentiment analysis? yes but what are adherance trends, etc.  Ai writes to the ui but when? are these cards displaying data from a table, or is this llm processing realtime with no persistence? how is the schema set up to suopport this?

  C. AI-assisted note enhancement
  workflow: No! no enhance to notes, the ai never writes notes, it only reads them, nor enhance nor correct nor edit, aio can however comment on notes in the ai insights  and if the user wants help to enhance a note they can copy the note to gpt 5 or claude or even open the chat assistant omnibot and paste the note in there and get the ai to enhance it within chat and then copyt he answer and paste it back int ot he note

- User writes quick capture note → User
  opens AI chat → Asks "enhance this note"
   → AI returns formatted text → User
  copies into new note?
- Should we provide a shortcut button:
  "Enhance with AI" directly in the quick
  capture interface?

### 6. Note Recording Button Placement

  You said NO floating button, but
  available in:

- Global header (top navigation bar) yes icon eith tooltip
- Global sidebar (left sidebar with main
   nav) no
- Within Contacts page (contacts
  list/table view) no but the contacts sidebar should have the add full note in the dsidebar the quick add note is still available fron the header as well
- Within Dashboard no, quick links will have full note add

  A. Icon/label preference:

  1. "📝 Quick Note" (icon + text)
  2. "🎤 Record Note" (microphone icon +
  text)
  3. Just icon (e.g., microphone or note
  icon) with tool tip

  B. Behavior on click:

- Always open quick capture modal/sheet?
- Or show context menu: "Type note" |
  "Record note" | "Note for contact..."?

  opens th emodal but the modal has to have the option to select which contact the note is for

### 7. Contact Card Layout Structure

For the contact details page, which
layout do you prefer?

A. Single-column layout (stacked
  vertically):
  [Latest Smart Notes Timeline Card]
  [3 Latest Full Note Cards]
  [Next Steps & Goals Card]
  [AI Insights Card - Collapsed by
  default] not this one

  B. Two-column layout:
  Left Column (70%):              Right
  Column (30%):

- Latest Smart Notes            -
  Contact Info
- 3 Latest Full Notes           -
  Upcoming Sessions
- Next Steps & Goals            - Quick
  Stats

  Bottom (Full Width):

this one, but the progressive display should be the 3 most recent notes on the top, the ai insights in the 30% but collapsed then the ai generated timeline with the next steps and next session in the 30% part and the goals below all that and the contacts contact record ie display name consent tags stage etc shown in the contact details header with their pohoto if they sent one and the main page would have overview like in preplecity and a second page for full notes infinite scroll and a third page dfor contact details wiuth all fioelds like email, address, preferences etc

- AI Insights (Collapsed)

  C. Tabbed interface with cards:
  Tabs: [Notes] [Timeline] [Overview]
  [Insights]

  Notes Tab:

- Latest Smart Notes Card
- 3 Latest Full Note Cards
- All Notes (infinite scroll)

### 8. Data & Relationships

  A. Session data source for timeline:

- Query interactions table where type =
  'session'? not sure how the events are stored but definitely will be from google calendar events weithin interactions as apposed to emails, user will keep a calendar for all appointmemtns and classes
- Or separate calendar_events table? no
- How to determine session type (e.g.,
  "Hot Stones Massage")? From
  interaction.subject or sourceMeta?

  B. Note-to-session linking:

- Should notes be automatically linked
  to sessions based on timestamp
  proximity? no, notes are for recording session notes about contact or notes about prospect etc so the last note will either not be linked to a session, or it will be linked to the last session, there needs to be a linking that remionds the user to complete the notes for the session, maybe a task in the prod suite with a link to the contact in the task
- Or require manual selection: "This
  note is about the Oct 10 Hot Stones
  session"? possible yes, might be clearer and easier to implemntent, and should be optional

  C. AI timeline construction:

- Should the "Latest Smart Notes"
  timeline be AI-generated summaries? yes
- Or deterministic extraction from notes no

- interactions + events? interactions are events, plus emails

### 9. Mobile Responsiveness

  A. Mobile card layout:

- Stack all cards vertically (single
  column)?yes
- Hide/collapse AI insights by default
  on mobile?yes
- Simplified timeline (hide left-side
  dates, show only circles + text)?yes

  B. Quick capture on mobile:

- Native device microphone API for voice
   recording?yes
- Simplified text-only interface (no AI
  enhance until desktop)?never enhance no enhancing of notes, only commentary about a note in the ai insights

### 10. Tags Display & Filtering

  From your previous specs, tags are
  important:

  A. Where should tags appear in the new
  card-based UI? no clue

- On each note card (as chips/badges)? yes
- As a filter bar above the cards? no
- Both? no

  B. Tag interaction:

- Click tag to filter all notes/cards by
   that tag? dont know whats possible feasibkle useful or practical
- Or open tag management dialog?

  ---
  Priority Ranking

  Given the new UI direction, which should
   we tackle first?

  A. Core Cards UI (Notes Timeline + 3
  Latest Notes + Next Steps/Goals) - ~5-6
  days

  B. Quick Capture Modal (Type + Voice
  recording) - ~3-4 days

  C. AI Insights Card (Secondary,
  collapsed by default) - ~2-3 days

  D. Timeline Construction Logic (Merge
  notes + sessions + events) - ~2-3 days

  Recommended sequence: B (Quick Capture)
  → A (Cards UI) → D (Timeline) → C (AI
  Insights)

  This allows practitioners to start
  capturing notes immediately, then we
  enhance the display progressively.

  ok

  ---
  Please answer the questions above
  (letters/numbers make it easy to
  reference), and I'll create a
  comprehensive PRD that captures this
  fantastic new vision! 🎯
